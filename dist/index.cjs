"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const i=require("./store-iEv7etia.cjs");function v(t){return t.replace(/[\[\]'"]/g,"").split(".")}const h=(t,e)=>{let n=Math.floor(Math.random()*1e6),r=typeof e=="string"?v(e):e;return{["$$@@@@__upsert_hook_"+n]:{value:t,index:r??null,isFunction:typeof t=="function"}}};h.at=(...t)=>{const e=t,n=e.pop();return h(n,e)};function _(t,e,n,r=!1,s,o=[]){const u=e;if(e.length<=1){if(e.length>0)try{return t[e[0]]=r?n(t[e[0]??e]):n,t}catch{throw`Setting Failed at index ${e[0]} of [${o.join(" => ")}] due to the type ${typeof t}, Only array or object is assignable`}if(t===null||typeof t!="object")throw Error("Initial value is not a object, ERROR: INITITAL_VALUE_PARSE_FAILED");let c=r?n(t):n;if(s.returnType=="array")return t.push(c),t;if(typeof c!="object")throw`Object or array can be setted only as a default value. Type of value is ${typeof c}.`;for(const d of Object.keys(c))t[d]=c[d];return t}let a=(t??[])[e[0]]??!1;if(!a){let c=y(e,n,r);try{t[e[0]]=c}catch{throw`Setting Failed at index ${e[0]} of [${o.join(" => ")}] due to the type ${typeof t}, Only array or object is assignable`}return t}return e.shift(),_(a,e,n,r,s,[...o,u[0]])}function y(t,e,n=!1){let r=[...t],s;return r.length==1?s=n?e(null):e:(s={},r.shift(),s[r[0]]=y(r,e,n)),s}function g({obj:t},e,n=[],r=!1){let s=[];for(let o in t){let u=t[o];if(o.includes(e)&&(u??!1))s.push({index:[...n,...u.index??[]],value:u.value,isFunction:u.isFunction});else if(typeof u=="object"){const a=g({obj:u},e,[...n,o],!0);s=s.concat(a.obj)}}return r?{obj:s}:{result:s}}function N(t,e,n={returnType:"object"}){let{result:r}=g({obj:e},"$$@@@@__upsert_hook");for(let s=0;s<r.length;s++){let o=r[s];_(t,o.index,o.value,o.isFunction,n)}}function p(t,...e){let n={returnType:"object"};const r=Array.isArray(t);r&&(n.returnType="array");for(let s of e)N(t,s,n);try{return new Proxy(t,{get(s,o,u){return s=r?[...t]:{...t},o==="get"?()=>u:o==="at"?(...a)=>{if(a.length<=1)throw"keys.length is less than 2, need atleast 2 values to differentiate index and value";const c=a[a.length-1],d=a;return d.pop(),_(t,d,c,typeof c=="function",n),u}:Reflect.get(s,o,u)}})}catch{throw Error(`Cannot return value as returnType '${n.returnType}'. Please try '${n.returnType=="array"?"OBJECT":"ARRAY"}' returnType, ERROR: RETURN_ERROR.`)}}const T={};let $=0,l={collection:{}};l.collection.store=t=>{const e=`__func_${$++}__`;return T[e]=t,e};l.collection.retrive=t=>T[t];l.collection.get=()=>T;l.store=t=>typeof t=="function"?l.collection.store(t):Array.isArray(t)?t.map(l.store):t!==null&&typeof t=="object"?Object.keys(t).reduce((e,n)=>(e[n]=l.store(t[n]),e),{}):t;l.fetch=t=>typeof t=="string"&&t.startsWith("__func_")&&t.endsWith("__")?l.collection.retrive(t):Array.isArray(t)?t.map(l.fetch):t!==null&&typeof t=="object"?Object.keys(t).reduce((e,n)=>(e[n]=l.fetch(t[n]),e),{}):t;function S(t){return h(()=>l.store(t))}const A=h;A.fun=S;const f={dependent_state:{},effects:{},registeredStates:{},resolved:{},registeredProcess:{},registeredDependency:{}};function w(t){var o,u;const{state_name:e,effect:n,dependent_state_names:r}=t;if(!Array.isArray(r)||r.length===0)throw TypeError("Second parameter of effect `dependent_states` must be a non-empty array.");if((o=f.registeredStates)!=null&&o[e])return;const s=e;f.registeredStates[e]=!0;for(let a of r){if(typeof a=="function"&&(a!=null&&a["@___usethis"])&&(a!=null&&a.this)&&(a=a.this),typeof a=="string")(u=f.dependent_state)!=null&&u[a]?f.dependent_state[a]=[...f.dependent_state[a],s]:f.dependent_state[a]=[s],f.registeredDependency[e]=[...f.registeredDependency[e]??[],a];else throw TypeError("Invalid type passed on `dependent_states`, Only string and useThis instance supported ");f.effects[s]=n}console.log(f)}function E(t){var e;if((e=f.dependent_state)!=null&&e[t])for(const n of f.dependent_state[t])try{f.effects[n](()=>D({dependent_state_name:t,state_name:n}))}catch{}}function D(t){const{dependent_state_name:e,state_name:n}=t;f.dependent_state[e]=f.dependent_state[e].filter(r=>r!==n),delete f.effects[n],f.resolved[n]=!0}function F(){return f}function R(t,e){return function(r){let s=typeof r=="function"?r(i._MAINSTORE.getState().This[t]):r;return e(i.StateHandler.update({data:s,state:t})),i._MAINSTORE.getState().This[t]}}function I(t,e){return function(r){let s=typeof r=="function"?r(i._MAINSTORE.getState().This[t]):r;return e(i.StateHandler.append({data:s,state:t})),i._MAINSTORE.getState().This[t]}}function O(t,e){var o,u;const n=(u=(o=i._MAINSTORE)==null?void 0:o.getState())==null?void 0:u.This[t];function r(a){try{const c=Array.isArray(n)?[...n]:{...n??{}};e(i.StateHandler.upsert({data:p(c,a),active_state:t,config:{}}))}catch(c){console.log(c)}}const s=(...a)=>{for(let c of a)r(c);return i._MAINSTORE.getState().This[t]};return s.at=(...a)=>{const c=Array.isArray(n)?[...n]:{...n??{}};return e(i.StateHandler.upsert({data:p(c).at(...a),active_state:t,config:{}})),i._MAINSTORE.getState().This[t]},s.funAt=(...a)=>{const c=Array.isArray(n)?[...n]:{...n??{}},d=l.store(a[a.length-1]);a.pop();const M=[...a,d];return e(i.StateHandler.upsert({data:p(c).at(...M),active_state:t,config:{}})),i._MAINSTORE.getState().This[t]},s}const x=(t,e)=>{var a;const n=i._MAINSTORE.dispatch,r=c=>{const d=n(c);return E(t),d},s=t;return!((a=i._MAINSTORE.getState())==null?void 0:a.This)[s]&&e&&!F().resolved[s]&&r(i.StateHandler.update({data:e,state:s})),{update:R(s,r),append:I(s,r),upsert:O(s,r),dispatcher:r,This:i._MAINSTORE.getState().This[s],get:()=>i._MAINSTORE.getState().This[s],fetch:()=>l.fetch(i._MAINSTORE.getState().This[s])}},m=t=>{const e=i._MAINSTORE.dispatch,n=o=>{const u=e(o);return E(t),u},r=t;return{...{update:R(r,n),append:I(r,n),upsert:O(r,n),dispatcher:n,This:i._MAINSTORE.getState().This[r],get:()=>i._MAINSTORE.getState().This[r],fetch:()=>l.fetch(i._MAINSTORE.getState().This[r])}}};function b(t){const e={created:!1,stateName:"state_"+Math.floor(1e5+Math.random()*9e5)};t&&typeof t=="object"&&(e.defaultData=t);const n=()=>{if(!e.created)throw Error("Cannot use useThis Instance without created");return H(e.stateName)};return n["@___usethis"]="0.1.53",n.this=e.stateName,n.onEffect=(r,s)=>(e.onEffect={resolver:r,dependent_states:s},n),n.stateName=r=>(e.stateName=r,n),n.default=r=>(e.defaultData=r,n),n.setConfig=(r,s)=>(e[r]=s,n),n.create=()=>{if(!e.created)return n.this=e.stateName,e.defaultData&&i._MAINSTORE.dispatch(i.StateHandler.update({data:e.defaultData,state:e.stateName})),e.onEffect&&w({state_name:e.stateName,dependent_state_names:e.onEffect.dependent_states??[],effect:r=>{var s;return(s=e.onEffect)==null?void 0:s.resolver({thisState:i._MAINSTORE.getState().This,state:o=>typeof o=="function"&&o["@___usethis"]?i._MAINSTORE.getState().This[o.this]:i._MAINSTORE.getState().This[o],resolver:()=>{i._MAINSTORE.dispatch(i.StateHandler.removeState({active_state:e.stateName})),r(),e.created=!1}})}}),e.created=!0,n},n.static={get:()=>i._MAINSTORE.getState().This[n.this]},n}function H(t){try{i.useSelector(e=>{var n;return(n=e.This)==null?void 0:n[t]})}catch{}return m(t)}function j(t,e){try{i.useSelector(n=>{var r;return(r=n.This)==null?void 0:r[t]})}catch{}return x(t,e)}function C(t,e){return new.target?b(t):j(t,e)}const P=C;exports.set=A;exports.setFun=S;exports.useThis=P;
//# sourceMappingURL=index.cjs.map
